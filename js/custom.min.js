var Fillow = (function() {
    "use strict";

    // Encapsulate screen dimensions to avoid redundant calculations
    const screenDimensions = {
        width: $(window).width(),
        height: $(window).height()
    };

    // Separate concerns and improve function readability
    function handleNiceSelect() {
        if ($('.default-select').length) {
            $('.default-select').niceSelect();
        }
    }

    function handlePreloader() {
        setTimeout(() => {
            $('#preloader').remove();
            $('#main-wrapper').addClass('show');
        }, 800);
    }

    function handleMetisMenu() {
        if ($('#menu').length) {
            $("#menu").metisMenu();
        }

        // Simplified active class handling
        $('.metismenu > .mm-active').each(function() {
            if (!$(this).children('ul').length) {
                $(this).addClass('active-no-child');
            }
        });
    }

    function handleAllChecked() {
        $("#checkAll").on('change', function() {
            $("td input, .email-list .custom-checkbox input").prop('checked', $(this).prop("checked"));
        });
    }

    function handleNavigation() {
        $(".nav-control").on('click', function() {
            $('#main-wrapper').toggleClass("menu-toggle");
            $(".hamburger").toggleClass("is-active");
        });
    }

    function handleCurrentActive() {
        const currentLocation = window.location.href;
        $("ul#menu a").filter(function() {
            return this.href === currentLocation;
        }).each(function() {
            $(this).addClass("mm-active")
                .parent().addClass("mm-active")
                .parents('li')
                .addClass("mm-show mm-active");
        });
    }

    function handleMiniSidebar() {
        $("ul#menu>li").on('click', function() {
            const sidebarStyle = $('body').attr('data-sidebar-style');
            if (sidebarStyle === 'mini') {
                $(this).find('ul').stop();
            }
        });
    }

    function handleMinHeight() {
        const windowHeight = window.outerHeight || screen.height;
        $(".content-body").css("min-height", `${windowHeight + 60}px`);
    }

    function handleDataAction() {
        $('a[data-action="collapse"]').on("click", function(e) {
            e.preventDefault();
            const $card = $(this).closest(".card");
            $card.find('[data-action="collapse"] i').toggleClass("mdi-arrow-down mdi-arrow-up");
            $card.children(".card-body").collapse("toggle");
        });
    }

    function handleHeaderHeight() {
        const $header = $('.header');
        const headerHeight = $header.innerHeight();

        $(window).scroll(function() {
            const isHorizontalLayout = 
                $('body').attr('data-layout') === "horizontal" &&
                $('body').attr('data-header-position') === "static" &&
                $('body').attr('data-sidebar-position') === "fixed";

            $('.dlabnav').toggleClass('fixed', isHorizontalLayout && $(this).scrollTop() >= headerHeight);
        });
    }

    function handleMenuTabs() {
        if (screenDimensions.width <= 991) {
            $('.menu-tabs .nav-link').on('click', function() {
                const $this = $(this);
                const $fixedContentBox = $('.fixed-content-box');
                const $hamburger = $('.hamburger');

                if ($this.hasClass('open')) {
                    $this.removeClass('open');
                    $fixedContentBox.removeClass('active');
                    $hamburger.show();
                } else {
                    $('.menu-tabs .nav-link').removeClass('open');
                    $this.addClass('open');
                    $fixedContentBox.addClass('active');
                    $hamburger.hide();
                }
            });

            $('.close-fixed-content').on('click', function() {
                $('.fixed-content-box').removeClass('active');
                $('.hamburger').removeClass('is-active').show();
                $('#main-wrapper').removeClass('menu-toggle');
            });
        }
    }

    function handleFullScreen() {
        $('.dlab-fullscreen').on('click', function() {
            const docElement = document.documentElement;
            const requestFullscreen = 
                docElement.requestFullscreen || 
                docElement.webkitRequestFullscreen || 
                docElement.mozRequestFullScreen || 
                docElement.msRequestFullscreen;

            const exitFullscreen = 
                document.exitFullscreen || 
                document.msExitFullscreen || 
                document.mozCancelFullScreen || 
                document.webkitExitFullscreen;

            if (document.fullscreenElement || 
                document.webkitFullscreenElement || 
                document.mozFullScreenElement || 
                document.msFullscreenElement) {
                exitFullscreen.call(document);
            } else {
                requestFullscreen.call(docElement);
            }
        });
    }

    function handleMenuPosition() {
        if (screenDimensions.width > 1024) {
            $(".metismenu > li").each(function() {
                const $subMenu = $('ul:first', this);
                
                if ($subMenu.length) {
                    const off = $subMenu.offset();
                    const docWidth = $("body").width();
                    const isRTL = $('html').hasClass('rtl');
                    
                    const isEntirelyVisible = isRTL 
                        ? (off.left + $subMenu.width() <= docWidth)
                        : (off.left > 0);

                    $subMenu.toggleClass('left', !isEntirelyVisible);
                }
            });
        }
    }

    // Public methods
    return {
        init: function() {
            handleMetisMenu();
            handleAllChecked();
            handleNavigation();
            handleCurrentActive();
            handleMiniSidebar();
            handleMinHeight();
            handleDataAction();
            handleHeaderHeight();
            handleMenuTabs();
            handleFullScreen();
            // Add other initialization methods as needed
        },
        load: function() {
            handlePreloader();
            handleNiceSelect();
        },
        resize: function() {
            handleMenuPosition();
        }
    };
})();

// Document Ready
$(document).ready(function() {
    'use strict';
    $('[data-bs-toggle="popover"]').popover();
    Fillow.init();
});

// Window Load
$(window).on('load', function() {
    'use strict';
    Fillow.load();
    setTimeout(Fillow.resize, 1000);
});

// Window Resize
$(window).on('resize', function() {
    'use strict';
    Fillow.resize();
});